<%- include('partials/header'); %>

<div class="container">
    <div class="row">
  <h1>View All Employess Details</h1>
  <br>
  <div class="form-group">
    <form action="/Employeesearch/" id="EmployeeForm" class="form-horizontal" method="post"  role="form">
      <div class="col-md-9">
        <input type="search" class="form-control" id="searchName" name="searchName"   placeholder="Search Employee Name">
    </div>
    <input type="submit" class="form-control btn btn-primary btn-sm" name="Search" >
  </form>
   
  </div>
  <br/>
  <table class="table table-striped table-primary">
    <thead>
        <tr>
          <th>Employee Name</th>
          <th>Department Name</th>
          <th>Employee Code</th>
          <th>Date Of Joining</th>
          <th>Action</th>
        </tr>
        <tbody>
          <% if(records.length>0){
            records.forEach(function(row){
            %>
            <tr>
                <td><%= row.Emp_Name %></td>
                <td><%= row.Department %></td>
                <td><%= row.Employee_Code %></td>
                <td><%= row.DOJ %></td>
                <td>
                <a class="btn btn-primary btn-xs" href="/employeesdetails/edit/<%= row._id %>"><i class="fa fa-edit"></i></a>
                <a class="btn btn-danger btn-xs" href="/employeesdetails/delete/<%= row._id %>" onclick="return confirm('Are you sure?')"><i class="fa fa-trash"></i></a>
                </td>
            </tr>
            <%  }) }else{ %>
              <p>No Data avaliable</p>
              <% } %>
        </tbody>
      </thead>

  </table>
  <div class="card-footer py-4">
    <nav aria-label="...">
    
        <% if (pages > 0) { %>
        <ul class="pagination justify-content-end mb-0">
            <% if (current == 1 ) { %>
                <li class="disabled page-item"><a class="page-link" >First</a></li>
            <% } else { %> 
            <li class="page-item ">
              <% if(query != ""){ %>
                <a class="page-link" href="<%= link %><%= query  %>1" tabindex="-1">
              <% } else { %>
                <a class="page-link" href="<%= link %>1" tabindex="-1">
              <% } %>
                    First
                </a>
            </li>
            <% } %>
            <% var i = (Number(current) > 5 ? Number(current) - 4 : 1) %>   
            <% if (i !== 1) { %>
                <li class="disabled page-item "><a class="page-link">...</a></li>
            <% } %>
            <% for (; i <= (Number(current) + 4) && i <= pages; i++) { %>
                <% if (i == current) { %>
                    <li class=" page-item "><a class="page-link"><%= i %></a></li>
                <% } else {   if(query != "") { %>
                    <li class="page-item "><a class="page-link" href="<%= link %><%= query %><%= i %>"><%= i %></a></li>
                    <% } else { %>
                      <li class="page-item "><a class="page-link" href="<%= link %><%= i %>"><%= i %></a></li>
                <% } } %>
                <% if (i == Number(current) + 4 && i < pages) { %>
                    <li class="disabled page-item "><a class="page-link">...</a></li>
                <% } %>
            <% } %>
            <% if (current == pages) { %>
                <li class="disabled page-item"><a class="page-link">Last</a></li>
            <% } else {  if(query != "") { %>
                <li class="page-item"><a class="page-link" href="<%= link %><%= query %><%= pages %>">Last</a></li>
            <% } else { %>
              <li class="page-item"><a class="page-link" href="<%= link %><%= pages %>">Last</a></li>
                <% } } %>    
        </ul>
        <% } %>
   
    </nav>
</div>


<div class="container">
  <div class="row">
    <% if(data.length > 0){
      data.forEach(function(row){
      %>
      <a class="btn btn-primary" href="/employee_by_department/<%= row.Dep_Name %>/1"><%= row.Dep_Name %></a>
     <%  }) } %>

  </div>
  </div>
  <script>
                   $(function(){
                     $('#searchName').autocomplete({
                      source:function(req,res){
                        $.ajax({
                          url:"/autocomplete/",
                          dataType:"jsonp",
                          type:"GET",
                          data:req,
                          success:function(data){
                                 res(data)
                          },
                          error:function(err){
                           console.log(err.status);
                          }
                        })
                        
                      }
                      ,
                        minLenght:3,
                        select:function(event,ui){
                          if(ui.item){
                            $('#searchName').text(ui.item.label)
                          }
                        }
                     })
                   })
                 </script>
    </div>
</div>
<%- include('partials/footer'); %>